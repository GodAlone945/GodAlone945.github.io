# rollup.js

Tags: 工具
简介: js模块打包器

1. 安装
    
    ```jsx
    npm i rollup -g
    ```
    
2. 新建项目，初始项目
    
    ```jsx
    mkdir rollup-demo // 新建项目文件夹
    cd rollup-demo    // 进入项目根目录
    npm init          // 初始化项目
    ```
    
3. 创建 src/main.js 编写源码
    
    ```jsx
    cd rollup-demo ## 进入项目根目录
    mkdir src      ## 创建 src 目录
    cd src
    touch main.js  ## 在 src 目录下创建 main.js
    ```
    
4. main.js 文件内容
    
    ```jsx
    var answer = '1000';
    export default function () {
    	console.log(`the answer is ${answer}`)
    }
    ```
    
5. rollup 配置文件
    
    根目录下新建 rollup.config.js
    
    ```jsx
    export default {
    	input: 'src/main.js',  // 入口文件
    	output: {
    		file: 'bundle.js',   // 输出文件名
    		format: 'cjs'        // 输出格式
    	}
    }
    ```
    
6. 修改 package.json 的 scripts
    
    ```jsx
    "scripts": {
    	"dev": "rollup -c"  // 打包命令
    }
    ```
    
7. 使用插件编译 babel
    
    安装 rollup-plugin-babel
    
    ```jsx
    npm i -D rollup-plugin-babel
    ```
    
    编辑 `rollup.config.js`, 添加插件配置
    
    ```jsx
    import babel from 'rollup-plugin-babel';
    
    export default {
    	input: 'src/main.js',
    	output: {
    		file: 'bundle.js',
    		format: 'cjs'
    	},
    	plugins: [
    		babel({
    			exclude: 'node_modules/**' // 不对node_modules进行编译
    		})
    	]
    }
    ```
    
8. 安装 babel 的相关依赖
    
    ```jsx
    npm i -D @babel/core @babel/preset-env
    ```
    
    在 src 目录下添加 .babelrc 配置文件 （项目根目录下也是可以的，区别在于 src 目录下的 .babelrc 只会影响 src 目录下的文件）
    
    ```jsx
    {
      "presets": [
        ["@babel/env", {"modules": false}]
      ]
    }
    ```
    
9. 将 main.js 更改为 es6 语法
    
    ```jsx
    const answer = '100';
    export default () => {
      console.log(`the answer is ${answer}。`);
    }
    ```
    
10. 使用 npm packages 依赖
    
    rollup 不知道如何处理 node_modules 中的依赖，需要通过插件 rollup-plugin-node-resolve 告诉 rollup 如何查找外部模块。
    
    ```jsx
    npm i -D rollup-plugin-node-resolve
    ```
    
    编辑 rollup.config.js
    
    ```jsx
    import resolve from 'rollup-plugin-node-resolve';
    import babel from 'rollup-plugin-babel';
    
    export default {
      input: 'src/main.js',
      output: {
        file: 'bundle.js',
        format: 'cjs'
      },
      plugins: [
        resolve(),
        babel({
          exclude: 'node_modules/**'
        })
      ]
    }
    ```
    
    现在就可以去代码中引用 node_modules 中的依赖了，以 the-answer 为例：
    
    ```jsx
    npm i the-answer
    ```
    
    ```jsx
    import answer from 'the-answer';
    
    export default () => {
      console.log(`the answer is ${answer}。`);
    }
    ```