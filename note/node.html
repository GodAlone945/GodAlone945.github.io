<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.38">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <title>node笔记 | 学习笔记</title><meta name="description" content="学习笔记">
    <link rel="modulepreload" href="/assets/app.92598d3d.js"><link rel="modulepreload" href="/assets/node.html.f05077c9.js"><link rel="modulepreload" href="/assets/node.html.94fb0345.js">
    <link rel="stylesheet" href="/assets/style.c1f02812.css">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/imgs/Icon1.ico" alt="学习笔记"><span class="site-name can-hide">学习笔记</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习笔记"><span class="title">学习笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习笔记"><span class="title">学习笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端基础笔记</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/js.html" class="" aria-label="javascript常用代码"><!--[--><!--]--> javascript常用代码 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/note/css.html" class="" aria-label="css常用样式"><!--[--><!--]--> css常用样式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目版本管理</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/git.html" class="" aria-label="Git笔记"><!--[--><!--]--> Git笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/vue-project.html" class="" aria-label="vue项目开发"><!--[--><!--]--> vue项目开发 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/note/node.html" class="router-link-active router-link-exact-active router-link-active" aria-label="node笔记"><!--[--><!--]--> node笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>桌面应用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/electron.html" class="" aria-label="electron"><!--[--><!--]--> electron <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-dark-button" title="toggle dark mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习笔记"><span class="title">学习笔记</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习笔记"><span class="title">学习笔记</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端基础笔记</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/js.html" class="" aria-label="javascript常用代码"><!--[--><!--]--> javascript常用代码 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/note/css.html" class="" aria-label="css常用样式"><!--[--><!--]--> css常用样式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>项目版本管理</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/git.html" class="" aria-label="Git笔记"><!--[--><!--]--> Git笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>前端框架</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/vue-project.html" class="" aria-label="vue项目开发"><!--[--><!--]--> vue项目开发 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>服务端</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a aria-current="page" href="/note/node.html" class="router-link-active router-link-exact-active router-link-active" aria-label="node笔记"><!--[--><!--]--> node笔记 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>桌面应用</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/note/electron.html" class="" aria-label="electron"><!--[--><!--]--> electron <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active collapsible">学习笔记 <span class="down arrow"></span></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/note/js.html" class="sidebar-item" aria-label="javascript常用代码"><!--[--><!--]--> javascript常用代码 <!--[--><!--]--></a><!----></li><li><a href="/note/css.html" class="sidebar-item" aria-label="css常用样式"><!--[--><!--]--> css常用样式 <!--[--><!--]--></a><!----></li><li><a href="/note/git.html" class="sidebar-item" aria-label="Git笔记"><!--[--><!--]--> Git笔记 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="node笔记"><!--[--><!--]--> node笔记 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/note/node.html#一、使用注意" class="router-link-active router-link-exact-active sidebar-item" aria-label="一、使用注意"><!--[--><!--]--> 一、使用注意 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#二、cookie-session-token" class="router-link-active router-link-exact-active sidebar-item" aria-label="二、cookie，session，token"><!--[--><!--]--> 二、cookie，session，token <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#三、require" class="router-link-active router-link-exact-active sidebar-item" aria-label="三、require"><!--[--><!--]--> 三、require <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#四、npm" class="router-link-active router-link-exact-active sidebar-item" aria-label="四、npm"><!--[--><!--]--> 四、npm <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/note/node.html#_4-1、npm网站" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.1、npm网站"><!--[--><!--]--> 4.1、npm网站 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_4-2、常用命令" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.2、常用命令"><!--[--><!--]--> 4.2、常用命令 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_4-3、npm下载慢" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.3、npm下载慢"><!--[--><!--]--> 4.3、npm下载慢 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_4-4、package-json-和-package-lock-json" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.4、package.json 和 package-lock.json"><!--[--><!--]--> 4.4、package.json 和 package-lock.json <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/note/node.html#五、模块化导入和导出" class="router-link-active router-link-exact-active sidebar-item" aria-label="五、模块化导入和导出"><!--[--><!--]--> 五、模块化导入和导出 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/note/node.html#_5-1、export" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.1、export"><!--[--><!--]--> 5.1、export <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_5-2、import" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.2、import"><!--[--><!--]--> 5.2、import <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/note/node.html#六、加载模板字符串" class="router-link-active router-link-exact-active sidebar-item" aria-label="六、加载模板字符串"><!--[--><!--]--> 六、加载模板字符串 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#七、url模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="七、url模块"><!--[--><!--]--> 七、url模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#八、http" class="router-link-active router-link-exact-active sidebar-item" aria-label="八、http"><!--[--><!--]--> 八、http <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/note/node.html#实例一" class="router-link-active router-link-exact-active sidebar-item" aria-label="实例一"><!--[--><!--]--> 实例一 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/note/node.html#九、express" class="router-link-active router-link-exact-active sidebar-item" aria-label="九、Express"><!--[--><!--]--> 九、Express <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/note/node.html#_9-1、基本路由" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.1、基本路由"><!--[--><!--]--> 9.1、基本路由 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-2、静态服务" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.2、静态服务"><!--[--><!--]--> 9.2、静态服务 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-3、在express中配置使用-art-template-模板引擎" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.3、在Express中配置使用 art-template 模板引擎"><!--[--><!--]--> 9.3、在Express中配置使用 art-template 模板引擎 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-4、在-express-中获取表单-get-请求参数" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.4、在 Express 中获取表单 GET 请求参数"><!--[--><!--]--> 9.4、在 Express 中获取表单 GET 请求参数 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-5、在express获取表单-post-请求体数据" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.5、在Express获取表单 POST 请求体数据"><!--[--><!--]--> 9.5、在Express获取表单 POST 请求体数据 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-6、路由设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.6、路由设计"><!--[--><!--]--> 9.6、路由设计 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-7、操作文件数据api模块" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.7、操作文件数据API模块"><!--[--><!--]--> 9.7、操作文件数据API模块 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-8、express-ssion" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.8、express-ssion"><!--[--><!--]--> 9.8、express-ssion <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-9、实例" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.9、实例"><!--[--><!--]--> 9.9、实例 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#_9-10、路由挂载" class="router-link-active router-link-exact-active sidebar-item" aria-label="9.10、路由挂载"><!--[--><!--]--> 9.10、路由挂载 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/note/node.html#十、修改完代码自动重启js文件" class="router-link-active router-link-exact-active sidebar-item" aria-label="十、修改完代码自动重启js文件"><!--[--><!--]--> 十、修改完代码自动重启js文件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#十一、文件操作路径和模块路径" class="router-link-active router-link-exact-active sidebar-item" aria-label="十一、文件操作路径和模块路径"><!--[--><!--]--> 十一、文件操作路径和模块路径 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#十二、promise-es6-解决毁掉地狱的问题" class="router-link-active router-link-exact-active sidebar-item" aria-label="十二、Promise-ES6(解决毁掉地狱的问题）"><!--[--><!--]--> 十二、Promise-ES6(解决毁掉地狱的问题） <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#封装promise版本的readfile" class="router-link-active router-link-exact-active sidebar-item" aria-label="封装Promise版本的readFile"><!--[--><!--]--> 封装Promise版本的readFile <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/note/node.html#十三、-node中的其他成员" class="router-link-active router-link-exact-active sidebar-item" aria-label="十三、 Node中的其他成员"><!--[--><!--]--> 十三、 Node中的其他成员 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/note/vue-project.html" class="sidebar-item" aria-label="vue项目开发"><!--[--><!--]--> vue项目开发 <!--[--><!--]--></a><!----></li><li><a href="/note/electron.html" class="sidebar-item" aria-label="electron"><!--[--><!--]--> electron <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><h1 id="node笔记" tabindex="-1"><a class="header-anchor" href="#node笔记" aria-hidden="true">#</a> node笔记</h1><h2 id="一、使用注意" tabindex="-1"><a class="header-anchor" href="#一、使用注意" aria-hidden="true">#</a> 一、使用注意</h2><ul><li>相对路径必须添加 <code>./</code></li><li>在node中，没有全局作用域，只有模块作用域 <ul><li>外部访问不到内部</li><li>内部也访问不到外部</li></ul></li><li>有时候，加载文件模块的目的不是为了简简单单的执行里面的代码，更重要是为了使用里面的对象，方法。</li></ul><ul><li>可以省略加载文件的后缀名——推荐</li></ul><ul><li>服务端渲染和客户端渲染的区别 <ul><li>客户端渲染不利于 <code>SEO</code> 搜索引擎优化。</li><li>服务端渲染是可以被爬虫抓取到的，客户端异步渲染是。</li></ul></li><li>所有的API都是异步加载</li><li>文件操作路径中，相对路径设计的就是相对于执行 <code>node</code> 命令所处的路径</li><li>服务端重定向针对异步请求无效</li></ul><h2 id="二、cookie-session-token" tabindex="-1"><a class="header-anchor" href="#二、cookie-session-token" aria-hidden="true">#</a> 二、cookie，session，token</h2><ul><li>cookie 在客户端记录状态</li><li>session 在服务端记录状态</li><li>token 维持状态 <ol><li>输入用户名和密码进行登录</li><li>服务器验证通过之后生成该用户的 token 并返回</li><li>客户端存储该 token</li><li>后续所有请求都携带该 token 发送请求</li><li>服务器验证 token 是否通过</li></ol></li></ul><p>当不存在跨域问题时，使用 cookie、session 管理登录状态 当存在跨域时，使用 token 管理登录状态</p><h2 id="三、require" tabindex="-1"><a class="header-anchor" href="#三、require" aria-hidden="true">#</a> 三、require</h2><ol><li>加载文件模块并执行里面的代码</li><li>拿到被加载文件模块导出的接口对象</li><li>优先从缓存中加载</li><li>第三方模块</li></ol><ul><li>凡是第三方模块都必须通过npm来下载</li><li>使用的时候就可以通过 <code>require</code>(&#39;包名&#39;) 的方式来进行加载才可以使用</li><li>不可能有任何一个第三方包和核心模块的名字是一样的</li><li>既不是核心模块、也是不路径形式的模块 <ul><li>先找到文件所处目录中的 <code>node_modules</code> 目录</li><li>node_modules/art-template</li><li>node_modules/art-template/package.json 文件</li><li>node_modules/art-template/package.json 文件中的 <code>main</code> 属性</li><li>main 记录了 <code>art-template</code> 的入口模块</li><li>然后加载使用这个第三方包</li><li>实际上最终加载的还是文件</li><li>如果 <code>package.json</code> 文件不存在或者main指定的入口模块不存在</li><li>则 <code>node</code> 会自动找该目录下的 <code>index.js</code></li><li>如果以上所有任何一个条件都不成立，则会层层往上一级目录中的 <code>node_modules</code> 中查找</li><li>直到跟文件换没有，则报错</li></ul></li></ul><blockquote><p>var template = require(&#39;art-template&#39;)</p></blockquote><h2 id="四、npm" tabindex="-1"><a class="header-anchor" href="#四、npm" aria-hidden="true">#</a> 四、npm</h2><h3 id="_4-1、npm网站" tabindex="-1"><a class="header-anchor" href="#_4-1、npm网站" aria-hidden="true">#</a> 4.1、npm网站</h3><blockquote><p>npmjs.com</p></blockquote><h3 id="_4-2、常用命令" tabindex="-1"><a class="header-anchor" href="#_4-2、常用命令" aria-hidden="true">#</a> 4.2、常用命令</h3><ul><li><code>npm init</code><ul><li><code>npm init -y</code> 可以跳过向导，快速生成</li></ul></li><li><code>npm install</code><ul><li>一次性把 <code>dependencies</code> 中的依赖项全部安装</li></ul></li><li><code>npm install 包名</code><ul><li>只下载</li></ul></li><li><code>npm install --save 包名</code><ul><li>下载并且保存依赖项</li><li>间写 <code>npm i -S 包名</code></li></ul></li><li><code>npm uninstall 包名</code><ul><li>只删除，依赖项依然会保存</li></ul></li><li><code>npm uninstall --save 包名</code><ul><li>删除的同时也会把依赖信息也去除</li><li><code>npm un -S 包名</code></li></ul></li><li>npm view less-loader versions 查看less-loader的版本</li></ul><h3 id="_4-3、npm下载慢" tabindex="-1"><a class="header-anchor" href="#_4-3、npm下载慢" aria-hidden="true">#</a> 4.3、npm下载慢</h3><p>淘宝镜像 <code>http://npm.taobao.org/</code></p><ul><li>安装淘宝的cnpm:</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --global cnpm
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>在之后的安装中把npm替换成cnpm</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>cnpm <span class="token function">install</span> jquery
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>对单个包使用淘宝镜像源</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> jquery --registry<span class="token operator">=</span>https://registry.npm.taobao.org
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>将镜像地址配置到npm的配置文件里</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> config <span class="token builtin class-name">set</span> registry https://registry.npm.taobao.org

<span class="token comment"># 查看 npm 配置信息</span>
<span class="token function">npm</span> config list

<span class="token comment">## npm命令行工具</span>

<span class="token function">npm</span> 的第二层含义就是 一个命令行工具，只要你安装了 <span class="token variable"><span class="token variable">`</span><span class="token function">node</span><span class="token variable">`</span></span> 就已经安装了 <span class="token variable"><span class="token variable">`</span><span class="token function">npm</span><span class="token variable">`</span></span>。

<span class="token comment"># 四、package.json-包说明文件</span>

```json
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,
  <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0.0.1&quot;</span>,
  <span class="token string">&quot;description&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;test&quot;</span>,
  <span class="token string">&quot;main&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;index.js&quot;</span>,
  <span class="token string">&quot;scripts&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;test&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0.0.1&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;author&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;GODALONE&quot;</span>,
  <span class="token string">&quot;license&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;ISC&quot;</span>,
  <span class="token string">&quot;dependencies&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;animation&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;^0.1.3&quot;</span>,
    <span class="token string">&quot;jquery&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;^3.5.1&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_4-4、package-json-和-package-lock-json" tabindex="-1"><a class="header-anchor" href="#_4-4、package-json-和-package-lock-json" aria-hidden="true">#</a> 4.4、package.json 和 package-lock.json</h3><ul><li><p>npm5 之前是不会有 <code>package-clock.json</code> 这个文件的</p></li><li><p>当安装包的时候，npm 都会生成或者更新 <code>package-lock.json</code> 这个文件</p></li><li><p>npm5 之后，安装包的时候不需要加 <code>--save</code> ，会自动保存依赖信息</p></li><li><p>加快利用配置文件重新下载包的速度</p></li><li><p>锁住下载依赖的版本，防止出现问题</p></li><li><p><code>npm init --yes</code> 自动配置包</p></li><li><p>目前来讲，最有用的是 <code>dependencies</code> 选项，可以用来帮我们保存第三方包的依赖信息。</p></li><li><p>执行 <code>npm install</code> 就会把 <code>package.json</code> 中的 <code>dependencies</code> 中所有的依赖项都下载回来。</p></li><li><p>建议每个项目的根目录中都有一个 <code>package.json</code> 文件</p></li><li><p>建议执行 <code>npm install 包名</code> 的时候都加上 <code>--save</code> 这个选项，目的是用来保存依赖项信息</p></li></ul><h2 id="五、模块化导入和导出" tabindex="-1"><a class="header-anchor" href="#五、模块化导入和导出" aria-hidden="true">#</a> 五、模块化导入和导出</h2><h3 id="_5-1、export" tabindex="-1"><a class="header-anchor" href="#_5-1、export" aria-hidden="true">#</a> 5.1、export</h3><ul><li>每个文件模块中都提供了一个对象：exports</li><li>exports默认是一个空对象。</li><li>把需要被外部访问的成员exports出去。</li><li>exports和 <code>module.exports</code>的一个引用</li><li>export default 导出的 引用时才可以去掉{}</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 隐性显示==========</span>
<span class="token keyword">var</span> module <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">exports</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span><span class="token punctuation">,</span>
    <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> module<span class="token punctuation">.</span>exports
<span class="token comment">//================</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>exports <span class="token operator">===</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">)</span> <span class="token comment">// =&gt; true</span>

exports<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span>

<span class="token comment">// 等价于</span>
module<span class="token punctuation">.</span>exports<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span> y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x <span class="token operator">+</span> y
<span class="token punctuation">}</span>
<span class="token comment">// 如果一个模块需要直接导出某个成员，而非挂载的方式</span>
<span class="token comment">// 必须使用下面这种方式</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span>

<span class="token comment">// 导出多个成员（必须在对象中）</span>
exports<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">123</span>
exports<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">c</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;ccc&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">foo</span><span class="token operator">:</span> <span class="token string">&#39;bar&#39;</span>
<span class="token punctuation">}</span>
exports<span class="token punctuation">.</span>add <span class="token operator">=</span> add

<span class="token comment">// 导出单个成员（拿到的就是：函数，字符串）</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token string">&#39;hello&#39;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">x<span class="token punctuation">,</span>y</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> x<span class="token operator">+</span>y
<span class="token punctuation">}</span>
上面这两个同时导出，后者会覆盖前者

也可以这样导出多个
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">add</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">str</span><span class="token operator">:</span> <span class="token string">&#39;hello&#39;</span>
 <span class="token punctuation">}</span>

<span class="token comment">// 另外一个页面接收</span>
<span class="token keyword">var</span> add <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./foo&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="_5-2、import" tabindex="-1"><a class="header-anchor" href="#_5-2、import" aria-hidden="true">#</a> 5.2、import</h3><p>要使用 <code>import</code> 命令来加载对应的模块，需要设置类型 <code>module</code></p><div class="language-html ext-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aaa.js<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>module<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>导出</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> flag <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">let</span> sum <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span>
  flag<span class="token punctuation">,</span> sum
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">var</span> total <span class="token operator">=</span> <span class="token number">1000</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">num1</span> <span class="token punctuation">(</span><span class="token parameter">num1<span class="token punctuation">,</span> num2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> num1 <span class="token operator">+</span> num2
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>导入</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> flag<span class="token punctuation">,</span> sum <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./aaa.js&#39;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>total<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./aaa.js&#39;</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span>num1<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;./aaa.js&#39;</span>

<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> aaa <span class="token keyword">from</span> <span class="token string">&#39;./aaa.js&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="六、加载模板字符串" tabindex="-1"><a class="header-anchor" href="#六、加载模板字符串" aria-hidden="true">#</a> 六、加载模板字符串</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> template <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;art-template&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 读取文件</span>
<span class="token comment">// readFile 的第二个参数是可选的，传入 utf8 就是告诉它把读取到的文件直接按照 utf8 编码</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./db.json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;server error.&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 从文件中获取到的数据一定是字符串</span>
    <span class="token comment">// 所以一定要转换成对象</span>
    <span class="token keyword">const</span> students <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>students

    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">fruits</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;苹果&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;香蕉&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;橘子&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;菠萝&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">students</span><span class="token operator">:</span> students
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./tpl.html&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404 Not Found.&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">var</span> ret <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;jack&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token number">18</span><span class="token punctuation">,</span>
    <span class="token literal-property property">province</span><span class="token operator">:</span> <span class="token string">&#39;北京市&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hobbies</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">&#39;写代码&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;唱歌&#39;</span><span class="token punctuation">,</span>
      <span class="token string">&#39;画画&#39;</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
  <span class="token comment">// res.end(data)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h2 id="七、url模块" tabindex="-1"><a class="header-anchor" href="#七、url模块" aria-hidden="true">#</a> 七、url模块</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> url <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;url&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span><span class="token string">&#39;/pinglun?name=wow$message=123&#39;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>query<span class="token punctuation">)</span>

<span class="token comment">// 解析请求URL中的后面的参数</span>
url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="八、http" tabindex="-1"><a class="header-anchor" href="#八、http" aria-hidden="true">#</a> 八、http</h2><p>1.加载HTTP核心模块</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;http&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 操作文件</span>
<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>
<span class="token comment">// 读取路径文件内容</span>
fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./www/index.html&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404 Not Found&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 读取访问路径里的文件内容</span>
fs<span class="token punctuation">.</span><span class="token function">readdir</span><span class="token punctuation">(</span><span class="token string">&#39;./www&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;不存在&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 获取机器信息</span>
<span class="token keyword">var</span> os <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;os&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 用来操作路径的</span>
<span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;path&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 用来获取某个目录中的文件名称</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>2.使用<code>http.createServer()</code> 方法创建一个web服务器</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>3.服务器要干嘛</p><ul><li>​ 提供对数据的服务</li><li>发请求</li><li>接收请求</li><li>处理请求</li><li>给个反馈</li><li>注册request请求事件</li><li>当客户请求过来，就会自动触发服务器的 request 请求事件，然后执行第二个参数：回调处理。</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;收到客户端的请求了&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li>request 请求事件处理函数，需要接受两个参数： <ul><li>request 请求对象 <ul><li>请求对象可以用来获取客户端的一些请求信息，例如请求路径</li></ul></li><li>response 响应对象 <ul><li>响应对象可以用来给客户端发送响应消息</li></ul></li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">request<span class="token punctuation">,</span> response</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;收到客户端的请求了&#39;</span><span class="token punctuation">)</span>
    
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;第一条数据&#39;</span><span class="token punctuation">)</span>
    response<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;第二条数据&#39;</span><span class="token punctuation">)</span>
    response<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>response 对象有一个方法： write 可以用来给客户端发送相应数据</li><li>write可以使用多次，但是最后一定要使用end来结束响应，否则客户端会一直等待</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;收到客户端的请求了&#39;</span><span class="token punctuation">)</span>
	
    结束的时候直接输出内容
	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;hello world!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li>正确告诉浏览器所发送内容的编码格式 <ul><li>text/plain 就是普通文本</li></ul></li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;request&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;text/plain; charset=utf-8&#39;</span><span class="token punctuation">)</span>
	res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;主页面&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>4.绑定端口号，启动服务器</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;服务器启动成功！&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="实例一" tabindex="-1"><a class="header-anchor" href="#实例一" aria-hidden="true">#</a> 实例一</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// </span>
  <span class="token keyword">var</span> parseObj <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token keyword">var</span> pathname <span class="token operator">=</span> parseObj<span class="token punctuation">.</span>pathname
  <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./view/index.html&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404 Not Found！&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">var</span> htmlStr <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">comments</span><span class="token operator">:</span> comments
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>htmlStr<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&#39;/public/&#39;</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;.&#39;</span> <span class="token operator">+</span> pathname<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404 Not Found&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">&#39;/post&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./view/post.html&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>pathname <span class="token operator">===</span> <span class="token string">&#39;/pinglun&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 无论/pinglun?xxx 之后是什么，都不用担心，pathname只包含请求路径</span>
    <span class="token comment">// res.end(JSON.stringify(parseObj.query))</span>

    <span class="token keyword">var</span> comment <span class="token operator">=</span> parseObj<span class="token punctuation">.</span>query
    comment<span class="token punctuation">.</span>dateTime <span class="token operator">=</span> <span class="token string">&#39;2017-11-2 17:11:22&#39;</span>
    comments<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span>

    <span class="token comment">// 服务端这个时候已经把数据存储好了，接下来就是让用户重新请求/首页</span>
    <span class="token comment">// 如何通过服务器让客户段重定向</span>
    <span class="token comment">//  1. 状态码设置为 302 临时重定向</span>
    <span class="token comment">//      statusCode</span>
    <span class="token comment">//  2. 在响应头中通过 Location 告诉客户端往哪儿重定向</span>
    <span class="token comment">//      setHeader</span>
    <span class="token comment">// 如果客户端发现收到服务器的响应的状态码是 302 就会自动去响应头中找 Location</span>
    res<span class="token punctuation">.</span>statusCode <span class="token operator">=</span> <span class="token number">302</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Location&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
    res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./view/err.html&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token string">&#39;404&#39;</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h2 id="九、express" tabindex="-1"><a class="header-anchor" href="#九、express" aria-hidden="true">#</a> 九、Express</h2><blockquote><p><strong>配置模板引擎和 <code>body-parser</code> 一定要在 <code>app.use(router)</code> 挂载路由之前</strong></p></blockquote><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 创建服务器 == http.createServer</span>
<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 公开指定目录</span>
<span class="token comment">// 只要这样做了，你就可以直接通过 `/public/xx` 的方式访问 `public` 目录中的所有资源了</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/public/&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;./public/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;heloo express!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;app is runing！&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_9-1、基本路由" tabindex="-1"><a class="header-anchor" href="#_9-1、基本路由" aria-hidden="true">#</a> 9.1、基本路由</h3><p>路由器</p><ul><li>请求方法</li><li>请求路径</li><li>请求处理函数 get：</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当你以 GET 方法请求 / 的时候，执行对应的处理函数</span>
app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Hello World!&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>post:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当你以 POST 方法请求 / 的时候，指定对应的处理函数</span>
app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Got a POST request&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_9-2、静态服务" tabindex="-1"><a class="header-anchor" href="#_9-2、静态服务" aria-hidden="true">#</a> 9.2、静态服务</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当省略第一个参数的时候，则可以通过省略 /public 的方式来访问</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;files&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 当以 /public/ 开头的时候，去 ./public/ 目录中找找对应的资源</span>
# 推荐
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/public&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

path<span class="token punctuation">.</span>join<span class="token operator">--</span><span class="token operator">--</span>将路径连接起来
app<span class="token punctuation">.</span><span class="token function">usr</span><span class="token punctuation">(</span><span class="token string">&#39;/static&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;public&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_9-3、在express中配置使用-art-template-模板引擎" tabindex="-1"><a class="header-anchor" href="#_9-3、在express中配置使用-art-template-模板引擎" aria-hidden="true">#</a> 9.3、在Express中配置使用 art-template 模板引擎</h3><ul><li><a href="https://github.com/aui/art-template" target="_blank" rel="noopener noreferrer">art-template-GitHub仓库<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="http://aui.github.io/art-template/" target="_blank" rel="noopener noreferrer">art-template-官网<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul><p>安装：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save art<span class="token operator">-</span>template
npm install <span class="token operator">--</span>save express<span class="token operator">-</span>art<span class="token operator">-</span>template
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>配置：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 当渲染后缀为html的模板时，使用的模板引擎是什么</span>
app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&#39;html&#39;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-art-template&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>使用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// express 默认回去项目中的 views 目录找 index.html</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;hello world!&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>如果希望修改默认的 <code>views</code> 试图渲染存储目录，可以：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 第一个 views 千万不要写错</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;views&#39;</span><span class="token punctuation">,</span> 目录路径<span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&#39;views&#39;</span><span class="token punctuation">,</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./views/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 默认就是 ./views 目录</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_9-4、在-express-中获取表单-get-请求参数" tabindex="-1"><a class="header-anchor" href="#_9-4、在-express-中获取表单-get-请求参数" aria-hidden="true">#</a> 9.4、在 Express 中获取表单 GET 请求参数</h3><p>express 内置了一个 API，直接通过 <code>req.query</code> 来获取</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>req<span class="token punctuation">.</span>query
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="_9-5、在express获取表单-post-请求体数据" tabindex="-1"><a class="header-anchor" href="#_9-5、在express获取表单-post-请求体数据" aria-hidden="true">#</a> 9.5、在Express获取表单 POST 请求体数据</h3><p>在 Express 中没有内置获取表单的 POST 请求体的 API，引用第三方包： <code>body-parser</code> 安装：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>npm install <span class="token operator">--</span>save body<span class="token operator">-</span>parser
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>引用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;body-parser&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 配置 body-parser</span>
<span class="token comment">// 只要加入这个配置，在 req 请求对象上会多出来一个属性： body</span>
<span class="token comment">// 可以世界通过 req.body 来获取表单 POST 请求体数据流</span>
<span class="token comment">// parse application/x-www-form-urlencoded</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">urlencoded</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">extended</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// parse application/json</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>bodyParser<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>使用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;Content-Type&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;text/plain&#39;</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token string">&#39;you posted:\n&#39;</span><span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_9-6、路由设计" tabindex="-1"><a class="header-anchor" href="#_9-6、路由设计" aria-hidden="true">#</a> 9.6、路由设计</h3><table><thead><tr><th style="text-align:center;">请求方法</th><th style="text-align:center;">请求路径</th><th style="text-align:center;">get参数</th><th style="text-align:center;">post 参数</th><th style="text-align:center;">备注</th></tr></thead><tbody><tr><td style="text-align:center;">GET</td><td style="text-align:center;">/students</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">渲染页面</td></tr><tr><td style="text-align:center;">GET</td><td style="text-align:center;">/students/new</td><td style="text-align:center;"></td><td style="text-align:center;"></td><td style="text-align:center;">渲染添加学生</td></tr><tr><td style="text-align:center;">POST</td><td style="text-align:center;">/students</td><td style="text-align:center;"></td><td style="text-align:center;">name,age,gender,hobbies</td><td style="text-align:center;">处理添加学生请求</td></tr><tr><td style="text-align:center;">GET</td><td style="text-align:center;">/students/edit</td><td style="text-align:center;">id</td><td style="text-align:center;"></td><td style="text-align:center;">渲染编辑页面</td></tr><tr><td style="text-align:center;">POST</td><td style="text-align:center;">/students/edit</td><td style="text-align:center;"></td><td style="text-align:center;">id,name,age,gender,hobbies</td><td style="text-align:center;">处理编辑学生请求</td></tr><tr><td style="text-align:center;">GET</td><td style="text-align:center;">/students/delete</td><td style="text-align:center;">id</td><td style="text-align:center;"></td><td style="text-align:center;">处理删除请求</td></tr></tbody></table><h3 id="_9-7、操作文件数据api模块" tabindex="-1"><a class="header-anchor" href="#_9-7、操作文件数据api模块" aria-hidden="true">#</a> 9.7、操作文件数据API模块</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * student.js
 * 数据操作文件模块
 * 职责：操作文件中的数据，只处理数据，不关心业务
 */</span>

<span class="token doc-comment comment">/**
 * 获取所有学生列表
 * return []
 */</span>
exports<span class="token punctuation">.</span><span class="token function-variable function">find</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span>

 <span class="token doc-comment comment">/**
  * 添加保存学生
  */</span>
 exports<span class="token punctuation">.</span><span class="token function-variable function">save</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

 <span class="token punctuation">}</span>

  <span class="token doc-comment comment">/**
   * 更新学生
   */</span>
  exports<span class="token punctuation">.</span><span class="token function-variable function">update</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * 删除学生
    */</span>
   exports<span class="token punctuation">.</span><span class="token function-variable function">delete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     
   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_9-8、express-ssion" tabindex="-1"><a class="header-anchor" href="#_9-8、express-ssion" aria-hidden="true">#</a> 9.8、express-ssion</h3><p>安装：</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> express-session
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>配置:</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// 配置加密字符串，它会在原有加密基础上和这个字符串拼起来去加密</span>
  <span class="token comment">// 目的是为了增加安全性，防止客户端恶意伪造</span>
  <span class="token literal-property property">secret</span><span class="token operator">:</span> <span class="token string">&#39;itcast&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resave</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token literal-property property">saveUninitialized</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 无论你是否使用 Session，我都默认直接给你分配一把钥匙</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>使用：</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 添加 Session 数据</span>
req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">&#39;bar&#39;</span>

<span class="token comment">// 获取 Session 数据</span>
req<span class="token punctuation">.</span>session<span class="token punctuation">.</span>foo
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>提示：默认 Session 数据是内存存储的，服务器一旦重启就会丢失，真正的生产环境会持久化存储</p><h3 id="_9-9、实例" tabindex="-1"><a class="header-anchor" href="#_9-9、实例" aria-hidden="true">#</a> 9.9、实例</h3><h4 id="_9-9-1初始实例" tabindex="-1"><a class="header-anchor" href="#_9-9-1初始实例" aria-hidden="true">#</a> 9.9.1初始实例</h4><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&#39;html&#39;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-art-template&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/public&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;./public/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">comments</span><span class="token operator">:</span> comments
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/admin&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;admin/text.html&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">&#39;GODALONE&#39;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/post&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;post.html&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/pinglun&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">// url参数传过来的数据接收</span>
<span class="token comment">// req.query 只能拿到 get 请求的参数</span>
  <span class="token keyword">var</span> comment <span class="token operator">=</span> req<span class="token punctuation">.</span>query
  comment<span class="token punctuation">.</span>dateTime <span class="token operator">=</span> <span class="token string">&quot;2077-1-1 10:58:32&quot;</span>
  comments<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>comment<span class="token punctuation">)</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;留言板功能已启动&#39;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="_9-10、路由挂载" tabindex="-1"><a class="header-anchor" href="#_9-10、路由挂载" aria-hidden="true">#</a> 9.10、路由挂载</h3><p><strong>app.js</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * app.js 入门模块
 * 职责：
 *    创建服务
 *    做一些服务相关配置
 *      模板引擎
 *      body-parser 解析表单 post 请求体
 *      提供静态资源服务
 *    挂载
 *    监听端口启动服务
 */</span>

<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./route&#39;</span><span class="token punctuation">)</span>

<span class="token keyword">var</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/node_modules/&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;./node_modules/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token string">&#39;/public/&#39;</span><span class="token punctuation">,</span> express<span class="token punctuation">.</span><span class="token function">static</span><span class="token punctuation">(</span><span class="token string">&#39;./public/&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">engine</span><span class="token punctuation">(</span><span class="token string">&#39;html&#39;</span><span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-art-template&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">// 把路由容器挂载到 app 服务中</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;!!!!!!!!!!!&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> app
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p><strong>router.js</strong></p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token doc-comment comment">/**
 * router.js 路由模块
 * 职责：
 *    处理路由
 *    根据不同的请求方法 + 请求路径设置具体请求处理函数
 */</span>

<span class="token keyword">var</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;fs&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 这样也不方便</span>
<span class="token comment">// module.exports = function (app) {</span>
<span class="token comment">//   app.get(&#39;/&#39;, function (req, res) {</span>

<span class="token comment">//     fs.readFile(&#39;./db.json&#39;, &#39;utf8&#39;, function (err, data) {</span>
<span class="token comment">//       if (err) {</span>
<span class="token comment">//         return res.status(500).send(&#39;server error.&#39;)</span>
<span class="token comment">//       }</span>
<span class="token comment">//       // 从文件中获取到的数据一定是字符串</span>
<span class="token comment">//       // 所以一定要转换成对象</span>
<span class="token comment">//       const students = JSON.parse(data).students</span>
  
<span class="token comment">//       res.render(&#39;index.html&#39;, {</span>
<span class="token comment">//         fruits: [</span>
<span class="token comment">//           &#39;苹果&#39;,</span>
<span class="token comment">//           &#39;香蕉&#39;,</span>
<span class="token comment">//           &#39;橘子&#39;,</span>
<span class="token comment">//           &#39;菠萝&#39;</span>
<span class="token comment">//         ],</span>
<span class="token comment">//         students: students</span>
<span class="token comment">//       })</span>
<span class="token comment">//     })</span>
<span class="token comment">//   })</span>
  
  
<span class="token comment">//   app.get(&#39;/status&#39;, function (req, res) {</span>
  
<span class="token comment">//   })</span>

<span class="token comment">// express 提供了更好的方式</span>

<span class="token keyword">var</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 创建一个路由</span>
<span class="token keyword">var</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 把路由都挂载到 router 路由容器中</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./db.json&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;server error.&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 从文件中获取到的数据一定是字符串</span>
    <span class="token comment">// 所以一定要转换成对象</span>
    <span class="token keyword">const</span> students <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>students

    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&#39;index.html&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">fruits</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&#39;苹果&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;香蕉&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;橘子&#39;</span><span class="token punctuation">,</span>
        <span class="token string">&#39;菠萝&#39;</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token literal-property property">students</span><span class="token operator">:</span> students
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/status&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/status&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> router

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br></div></div><h2 id="十、修改完代码自动重启js文件" tabindex="-1"><a class="header-anchor" href="#十、修改完代码自动重启js文件" aria-hidden="true">#</a> 十、修改完代码自动重启js文件</h2><ol><li>使用第三方命令行工具， <code>nodemon</code> 来帮助我们解决频繁修改代码重启服务器问题。</li><li>安装</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> --global nodemon
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>安装完后使用</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">node</span> app.js
<span class="token comment"># 使用 nodemon</span>
nodemon app.js
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>当文件发生变化是，自动自动重启服务器</p><h2 id="十一、文件操作路径和模块路径" tabindex="-1"><a class="header-anchor" href="#十一、文件操作路径和模块路径" aria-hidden="true">#</a> 十一、文件操作路径和模块路径</h2><ol><li>文件操作路径</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code># <span class="token operator">**</span>在文件操作中<span class="token operator">**</span>
    # <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">./data/a.txt</span><span class="token template-punctuation string">`</span></span> 相当于当前目录
    # <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">data/a.txt</span><span class="token template-punctuation string">`</span></span> 相对于当前目录
    # <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">/data/a.txt</span><span class="token template-punctuation string">`</span></span> 当前文件模块所处磁盘根目录
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>模块操作路径</li></ol><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 忽略了 `.` 访问的是磁盘根目录</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;/data/foo.js&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 相对路径</span>
<span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./data/foo.js&#39;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="十二、promise-es6-解决毁掉地狱的问题" tabindex="-1"><a class="header-anchor" href="#十二、promise-es6-解决毁掉地狱的问题" aria-hidden="true">#</a> 十二、Promise-ES6(解决毁掉地狱的问题）</h2><ul><li>promise 本身不是异步，但其内部往往是封装一个异步</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code># 创建 Promise 容器
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span><span class="token string">&#39;./data/a.txt&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当异步代码执行成功时，调用 resolve(...)</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 当异步代码失败时，调用 reject(...)</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

p1
<span class="token comment">// then 里的函数就是 resolve</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 下面的function 就是调用 reject</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// then 里的函数就是 resolve</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 该return 的值传递到下面 ----------</span>
    <span class="token keyword">return</span> p2                         <span class="token operator">-</span>
    <span class="token comment">// 下面的function 就是调用 reject   -</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                 <span class="token operator">-</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>                  <span class="token operator">-</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>                                  <span class="token operator">-</span>
  <span class="token punctuation">.</span><span class="token function">then</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">--</span><span class="token operator">-</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token comment">// 由下方的 then 接收 返回值</span>
    <span class="token keyword">return</span> p3
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;end&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h2 id="封装promise版本的readfile" tabindex="-1"><a class="header-anchor" href="#封装promise版本的readfile" aria-hidden="true">#</a> 封装Promise版本的readFile</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 封装 Promise</span>
<span class="token keyword">function</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token parameter">filePath</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当异步代码执行成功时，调用 resolve(...)</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当异步代码失败时，调用 reject(...)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用</span>
<span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">&#39;./data/data.json&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">&#39;./data/data1.json&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token function">pReadFile</span><span class="token punctuation">(</span><span class="token string">&#39;./data/data2.json&#39;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><h2 id="十三、-node中的其他成员" tabindex="-1"><a class="header-anchor" href="#十三、-node中的其他成员" aria-hidden="true">#</a> 十三、 Node中的其他成员</h2><p>每个模块中，除了 <code>require</code>、<code>exports</code>等模块相关API之外，还有连个特殊的成员</p><ul><li><code>__dirname</code> 获取当前文件模块所属目录的绝对路径</li><li><code>__filename</code> 可以用来获取当前文件的绝对路径</li></ul><p>在文件操作中，使用相对路径是不可靠的，因为在 <code>Node</code> 中文件操作的路径被设计为相对于执行 <code>node</code> 命令所处的路径。</p><p>推荐使用 <code>path.join()</code>进行路径拼接</p><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&#39;./a.txt&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&#39;utf8&#39;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> err
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>为了尽量避免问题，在文件操作中使用的相对路径都统一转换为<strong>动态的绝对路径</strong></p><blockquote><p>模块中的路径标识和这里的路径没关系，不受影响</p></blockquote><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: wangdawei945@163.com">王大伟</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/note/git.html" class="" aria-label="Git笔记"><!--[--><!--]--> Git笔记 <!--[--><!--]--></a></span><span class="next"><a href="/note/vue-project.html" class="" aria-label="vue项目开发"><!--[--><!--]--> vue项目开发 <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app.92598d3d.js" defer></script>
  </body>
</html>
