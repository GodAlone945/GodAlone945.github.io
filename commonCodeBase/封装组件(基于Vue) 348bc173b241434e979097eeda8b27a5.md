# 封装组件(基于Vue)

Created: July 14, 2021 6:27 PM
标签: JS, vue, 组件封装

[封装组件.zip](.zip)

# 注意事项

- 在使用`script`引用打包好的`js`文件时，`.vue`文件里已驼峰命名法，建立的变量，在`HTML`中使用时，需要转换格式，如：`propData ⇒ prop-data`

# 封装过程

1. 初始化项目
    
    使用`webpack-simple`方便修改配置文件
    
    ```powershell
    vue init webpack-simple 项目名称
    ```
    
2. 修改文件目录
    1. 在`src`目录下新建`components`文件夹，在此文件夹下建立`Main.vue`文件
        
        `Main.vue` ⇒ 用来开发组件
        
        `App.vue`  ⇒ 用来进行本地开发，测试
        
    2. 在 `webpack.config.js` 同级目录下新建 `index.js` 文件，`index.js` 是把 `Main.vue` 文件暴露出去的出口
3. 修改文件内容，配置
    1. Main.vue
        
        ```jsx
         <template>
          <div class="container">
            <div>{{msg}}</div>
            <div>{{propData}}</div>
          </div>
        </template>
        
        <script>
        export default {
          name: 'yyl-npm-practice',
          data () {
            return {
              msg: 'Welcome to Your Vue.js App'
            }
          },
          props: {
              propData: {
                  type: String,
                  default: '我是默认值'
              }
          }
        }
        </script>
        
        <style lang="scss">
        .container{
            text-align: center;
        }
        </style>
        ```
        
    2. index.js
        
        ```jsx
        import Main from './src/components/Main'
        import _Vue from 'vue'
         
        // 这一步判断window.Vue是否存在，因为直接引用vue.min.js， 它会把Vue绑到Window上，我们直接引用打包好的js才能正常跑起来。
        if (typeof window !== 'undefined' && window.Vue) {
        	window.Vue.component('yyl-npm-practice', Main)
        }
        
        //这样就可以使用Vue.use进行全局安装了。
        Main.install = function(Vue){
        	if (!Vue) {
        		window.Vue = Vue = _Vue
        	}
        	Vue.component(Main.name, Main)
        }
        export default Main
        ```
        
    3. App.vue
        
        ```jsx
        <template>
          <div>
            <Main :propData='initData'/>
          </div>
        </template>
        
        <script>
        import Main from './components/Main'
        export default {
            data(){
              return {
                initData: 'hello 这里是陈杨下的年华'
              }
            },
            components:{
              Main
            }
        }
        </script>
        
        <style>
        
        </style>
        ```
        
    4. package.json
        
        `package.json` 修改 `private` 字段（`private` 是 `true` 的时候不能发布到 `npm`，需设置成 `false`）；并增加 `main` 字段， `main` 字段是 `require` 方法可以通过这个配置找到入口文件，
        
        **目录的加载规则**
        
        `require` 发现参数字符串指向一个目录以后，会自动查看该目录的`package.json`文件，然后加载`main`字段指定的入口文件。如果`package.json`文件没有`main`字段，或者根本就没有`package.json`文件，则会加载该目录下的`index.js`文件或`index.node`文件。
        
        ```jsx
        {
        	"private": false,
        	"main": "./dist/test.js"
        }
        ```
        
    5. 修改 webpack.config.js
        
        ```jsx
        var path = require('path')
        var webpack = require('webpack')
        const process = require("process");
        const NODE_ENV = process.env.NODE_ENV
        
        module.exports = {
        	entry: NODE_ENV === 'development' ? './src/main.js' : './index.js',
          output: {
            path: path.resolve(__dirname, './dist'),
            publicPath: '/dist/',
            filename: 'test.js',
            library: 'test',      // 指定的就是你使用 require 时的模块名
            libraryTarget: 'umd', // 指定输出格式
            umdNamedDefine: true
          }
        }
        
        devtool: '#eval-source-map' ===== 删除
        
        if (process.env.NODE_ENV === 'production') {
          // module.exports.devtool = '#source-map'
          // http://vue-loader.vuejs.org/en/workflow/production.html
          module.exports.plugins = (module.exports.plugins || []).concat([
            new webpack.DefinePlugin({
              'process.env': {
                NODE_ENV: '"production"'
              }
            }),
            new webpack.optimize.UglifyJsPlugin({
              sourceMap: true,
              compress: {
                warnings: false
              }
            }),
            new webpack.LoaderOptionsPlugin({
              minimize: true
            })
          ])
        } else {
          module.exports.devtool = '#eval-source-map'
        }
        ```