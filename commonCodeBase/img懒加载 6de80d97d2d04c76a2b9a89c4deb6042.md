# img懒加载

Created: May 28, 2022 9:03 PM
标签: img, lazy

## 1. 原理

在图片没有进入可视区域时，先不给`img` 的`src`赋值，这样浏览器就不会发送请求，等图片进入可视区域再给`src` 赋值。

## 2. 懒加载思路及实现

1. 加载loading图片
2. 判断哪些图片要加载
3. 隐形加载图片
4. 替换真图片

### 1. 加载loading图片在html部分实现

```html
<img src="img/loading.gif" data-src="img/pic1.jpg">
<img src="img/loading.gif" data-src="img/pic2.jpg">
<img src="img/loading.gif" data-src="img/pic3.jpg">
<img src="img/loading.gif" data-src="img/pic4.jpg">
```

### 2. 判断图片是否进入可视区域

![微信图片_20220528211011.jpg](%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20220528211011.jpg)

当`offsetTop ≤ scrollTop + clientHeight`

```jsx
window.onload = function () {
	// 获取图片列表
	const imgs = document.querySelector('img')
	// 获取图片到页面顶部的距离
	function getTop (e) {
		return e.offsetTop
	}
	// 懒加载实现
	function lazyload (imgs) {
		// 可视区域高度
		const viewHeight = document.clientHeight
		// 滚动区域高度
		const scrollHeight = document.documentElement.scrollTop || document.body.scrollTop
		imgs.forEach((e,i) => {
			// 图片顶部到页面顶部距离大于可视区域和滚动区域时进行懒加载
			if ((viewHeight + scrollHeight) > getTop(e)) {
				(function(e) {
					setTimeout(() => {
						const img = new Image()
						img.src = e.getAttribute('data-src')
						img.onload = () => {
							e.src = e.getAttribute('data-src')
						}
					}, 2000)
				})(e)
			}
		})
	}
	lazyload(imgs)

	// 滚屏函数
	window.onscroll = function () {
		lazyload(imgs)
	}
}
```