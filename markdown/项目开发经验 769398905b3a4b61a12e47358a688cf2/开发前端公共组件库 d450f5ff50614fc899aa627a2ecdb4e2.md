# 开发前端公共组件库

Created: December 12, 2021 7:51 PM
Tags: vue, 组件开发

# 一、webpack

## 1. 初始化项目

`vue init webpack-simple npm-practive`  —— 下载项目文件

`npm install`  —— 下载依赖文件

`npm run dev` —— 运行项目

## 2. 修改文件目录

1. 在 `src` 目录下西新建`compenents`文件夹，然后再此文件夹下建立 `Main.vue` 文件
    
    `App.vue` 是用于本地开发，测试用的入口文件，也就是用于 `npm run dev` 的入口文件 
    
2. 在 `webpack.config.js` 同级目录下新建`index.js` 文件，用于将`Main.vue` 文件暴露出去。

## 3. 修改文件内容，配置

1. `Main.vue` 内容（注意name）

```html
<template>
  <div class="container">
    <div>{{ msg }}</div>
    <div>{{ propData }}</div>
  </div>
</template>

<script>
export default {
  name: "yyl-npm-practice",
  data () {
    return  {
      msg: 'Welcome to Your Vue.js App'
    }
  },
  props: {
    propData: {
      type: String,
      default: '默认值'
    }
  }
}
</script>

<style scoped>
.container {
  text-align: center;
}
</style>
```

1. `App.vue` 内容

```html
<template>
  <div>
    <Main :propData='initData'></Main>
  </div>
</template>

<script>
import Main from './components/Main'
export default {
  data () {
    return {
      initData: 'Hello World!'
    }
  },
  components: {
    Main
  }
}
</script>

<style>

</style>
```

1. `index.js` 内容

```jsx
import Main from './src/components/Main'
import _Vue from 'vue'

Main.install = Vue => {
  if (!Vue) {
    window.Vue = Vue = _Vue
  }
  Vue.component(Main.name, Main)
}
export default Main
```

## 4. 修改 `package.json`

package.json需要修改private字段(private是true的时候不能发布到npm,需设置成false)； 并增加main字段， main字段是require方法可以通过这个配置找到入口文件，这输入模块加载规范，具体可以参考  这里， 主要内内容截图如下：

![Untitled](%E5%BC%80%E5%8F%91%E5%89%8D%E7%AB%AF%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6%E5%BA%93%20d450f5ff50614fc899aa627a2ecdb4e2/Untitled.png)

![Untitled](%E5%BC%80%E5%8F%91%E5%89%8D%E7%AB%AF%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6%E5%BA%93%20d450f5ff50614fc899aa627a2ecdb4e2/Untitled%201.png)

## 5. 修改 `webpack.config.js`

![Untitled](%E5%BC%80%E5%8F%91%E5%89%8D%E7%AB%AF%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6%E5%BA%93%20d450f5ff50614fc899aa627a2ecdb4e2/Untitled%202.png)

## 6. 修改 `index.html` 的 `js` 引用路径

![Untitled](%E5%BC%80%E5%8F%91%E5%89%8D%E7%AB%AF%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6%E5%BA%93%20d450f5ff50614fc899aa627a2ecdb4e2/Untitled%203.png)

![Untitled](%E5%BC%80%E5%8F%91%E5%89%8D%E7%AB%AF%E5%85%AC%E5%85%B1%E7%BB%84%E4%BB%B6%E5%BA%93%20d450f5ff50614fc899aa627a2ecdb4e2/Untitled%204.png)

## 7. 使用方法

1. 组件内使用

```jsx
html: 

　　<Main/>

js：

    import Main from 'yyl-npm-practice'

    components: {
      Main
    }
```

1. main.js 全局安装

```jsx
import Main from 'yyl-npm-practice'
Vue.use(Main)
```

1. 直接引用

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
</head>
<body>
<div id="app">
  <yyl-npm-practice :propData="propData"></yyl-npm-practice>
</div>
<script src="https://unpkg.com/vue/dist/vue.js"></script>
<script src="./dist/yyl-npm-practice.js"></script>
<script>
  new Vue({
    el: '#app',
    data: function() {
      return {
        propData: '11111111111111111111'
      }
    },
    methods: {
    }
  })
</script>
</body>
</html>
```

## 8. 打包字体和文字

```jsx
{
    test: /\.(png|jpg|gif|svg)$/,
    loader: 'url-loader',
    options: {
      name: '[name].[ext]?[hash]',
      limit: 99999
    }
    },
    { 
    test: /\.(svg|ttf|eot|woff|woff2)$/, 
    loader: 'url-loader', 
    options:{ 
     name:'[name].[ext]',
        limit: 9999999
    } 
}
```

# 二、rollup.js

## 1. 安装 `rollup.js` 打包工具

1. 全局安装 `rollup`

```bash
npm i rollup -g
```

1. 新建项目，初始项目

```bash
mkdir rollup-demo  ## 新建项目文件夹
cd rollup-demo     ## 进入项目根目录
npm init           ## 初始化项目
```

## 2. 编写 `bundle.js`

1. 创建 `src/main.js` 编写源码

```bash
cd rollup-demo
mkdir src
cd src
touch main.js  ## 创建main.js
```

1. `main.js` 内容

```jsx
var answer = '100';
export default function () {
	console.log(`the answer is ${answer}`)
}
```

## 3. 工具库的相关配置

1. rollup 配置文件
    
    在项目根目录下新建 `rollup.config.js`
    
    ```jsx
    export default {
    	input: "src/main.js",  // 入口文件
    	output: {
    		file: "bundle.js",  // 输出文件名
    		format: "cjs"       // 输出格式
    	}
    }
    ```
    
2. 修改 `package.json` 的 `scripts`
    
    ```jsx
    "scripts": {
    	"dev": "rollup -c"  // 打包命令
    }
    ```
    
    运行 `npm run dev` 打包编译
    
    生成的`bundle.js` 文件内容
    
    ```jsx
    'use strict';
    
    var answer = '100';
    function main () {
      console.log("the answer is ".concat(answer, "\u3002"));
    }
    
    module.exports = main;
    ```
    
3. 使用插件编译`babel`
    
    3.1 安装`rollup-plugin-babel`
    
    ```jsx
    npm i -D rollup-plugin-babel
    ```
    
    编辑`rollup.config.js` ，添加插件配置
    
    ```jsx
    import babel from 'rollup-plugin-babel';
    
    export default {
      input: 'src/main.js',
      output: {
        file: 'bundle.js',
        format: 'cjs'
      },
      plugins: [ // 增加 plugins
        babel({
          exclude: 'node_modules/**' // 不对node_modules进行编译
        })
      ]
    }
    ```
    
    3.2 安装babel的相关依赖
    
    ```jsx
    npm i -D @babel/core @babel/preset-env
    ```
    
    在`src`目录下添加`.babelrc` 配置文件（项目根目录下也是可以的，区别在于src目录下的`.babelrc` 只会影响 `src` 目录下的文件
    
    ```jsx
    {
      "presets": [
        ["@babel/env", {"modules": false}]
      ]
    }
    ```
    
    3.3 将 `main.js` 更改为 `es6` 语法
    
    ```jsx
    const answer = '100';
    export default () => {
      console.log(`the answer is ${answer}。`);
    }
    ```
    
    重新打包 `npm run dev`
    
    ```jsx
    'use strict';
    
    var answer = '100';
    var main = (function () {
      console.log("the answer is ".concat(answer, "\u3002"));
    });
    
    module.exports = main;
    ```
    
4. 使用 `npm packages` 依赖
    
    `rollup` 不知道如何处理 `node_modules` 中的依赖，需要通过插件 `rollup-plugin-node-resolve` 告诉 `rollup` 如何查找外部模块
    
    ```jsx
    npm i -D rollup-plugin-node-resolve
    ```
    
    编辑 `rollup.config.js`
    
    ```jsx
    import resolve from 'rollup-plugin-node-resolve';
    import babel from 'rollup-plugin-babel';
    
    export default {
      input: 'src/main.js',
      output: {
        file: 'bundle.js',
        format: 'cjs'
      },
      plugins: [
        resolve(),
        babel({
          exclude: 'node_modules/**'
        })
      ]
    }
    ```